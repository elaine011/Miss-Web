<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="descriotion" content="即期品與物資共享平台">
    <meta name="robots" content="index,follow">
    <!--網頁標籤-->
    <link rel="shortcut icon" href="../images/盈盈ㄉlogo2_last_-removebg-preview (2).png"/>
      <link rel="bookmark" href="../images/盈盈ㄉlogo2_last_-removebg-preview (2).png"/>
      <title>Miss覓食</title>
    <!--字型-->
      <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/register.css"/>
    
    <script src="https://kit.fontawesome.com/71e88eb3c1.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
        function tname(){
        var acc=document.getElementById("acc").value;
        var nullname=document.getElementById("nullname");
        if(acc==null||acc==""){
        alert("使用者名稱不能為空！");
        return false;
        }else  if(acc.length<6||acc.length>=15){
        alert("使用者名稱長度為6-15個字元長度！");
        return false;
        }else{
        nullname.innerHTML="";
        return true;
        }   
        }
        function tmail(){
        var email=document.getElementById("email").value;
        var nullmail=document.getElementById("nullmail");
        var reg=/[\w-]+@([\w-]+\.)+[\w-]+/;
        if(email==null||email==""){
        alert("電子信箱不能為空！！！");
        return false;
        }else if(!reg.test(email)){
        alert("請輸入正確的Email地址！！");
        return false;   
        }else{
        nullmail.innerHTML="";
        return true;
        }
        }
        
        function ppwd(){
        var pw=document.getElementById("pw").value;
        var nullpwd=document.getElementById("nullpwd");
        if(pw==null||pw==""){
        return false;
        }
        else{
        nullpwd.innerHTML="";
        return true;
        }    
        }
        
       function ttpwd(){
         var pw=document.getElementById("pw").value;
         var pw2=document.getElementById("pw2").value;
           var nulltpwd=document.getElementById("nulltpwd");
           if(pw2==null||pw2==""){
           alert("確認密碼不能為空！！！");
           return false;
           }else if(pw2!=pw){
           alert("兩次密碼輸入不一致");
           return false;
           }else{
           nulltpwd.innerHTML="";
           return true;
           }      
       } 
       
       
       function ttel(){
       var phonenumber=document.getElementById("phonenumber").value;
       var nulltel=document.getElementById("nulltel")
       var reg=/^09\d{8}$/
       if(phonenumber==null||phonenumber==""){
       return false;
       }else if(phonenumber.length!=10||!reg.test(phonenumber)){
       alert("請填寫正確手機號碼!");
       return false;
       }else {
       nulltel.innerHTML="";
       return true;
       }
       }
       function reg(){
       if(tname()&&ppwd()&&ttpwd()&&ttel()){
       document.forms[0].submit();
       alert("於簡訊及電子信箱驗證後即註冊成功!!");
       return true;
       }else{
       return false;
       }
       }
        </script>
</head>
<body>
        <span>
            <a href="./alllogin.html"><img  class="logo" src="../images/logo底修改.png" alt="Miss覓食"></a>
        </span><br>
        <span>
            <h3 class="logintext">Miss覓食註冊</h3>  
        </span><br>
        <ul class="list">
            <li >
                <i class="fas fa-balance-scale"></i>
                會員條款
            </li>
            <li class="active">
                <i class="far fa-id-badge"></i>
                填寫資料
            </li>
            <li>
                <i class="fas fa-envelope-open-text"></i>
                信箱驗證</li>
            <li>
                <i class="far fa-check-circle"></i>
                註冊完成
            </li>
        </ul>
        <div id="Registration">
        <form action="regUser" method="GET">
        <table>
            <tr>
                <td class="topname">使用者名稱:</td>
                <td><input id="acc" class="name" type="text" name="acc" onblur="tname()" placeholder="6-15英/數字" required></td>
                <td><div id="nullname"></div></td>
            </tr>
            <tr>
                <td class="topname">電子信箱:</td>
                <td class="phtd"><input class="email" id="email" type="email" name="email" onblur="tmail()" placeholder="帳號" required></td>
                <td><div id="nullemail"></div></td>
            </tr>
            <tr>
                <td class="topname">設定登入密碼:</td>
                <td><input id="pwd" class="pwd" type="password" name="pwd" onblur="ppwd()" minlength="6" maxlength="20" placeholder="請輸入密碼" required><i class="far fa-eye-slash" onclick="hideShowPsw()" id="eye"></i></td>
                <td><div id="nullpwd"></div></td>
                <script type="text/javascript">
                    var eye = document.getElementById("eye");
                    var pwd = document.getElementById("pwd");

            function hideShowPsw(){

                    if (pwd.type == "password") {
                        pwd.type = "text";
                            eye.className='fa fa-eye'
                    }else {
                        pw.type = "password";
                        eye.className='fa fa-eye-slash'
                    }
            }
            </script>
            </tr>
            <tr>
                <td class="topname">確認登入密碼:</td>
                <td><input id="pw2" class="pw2" type="password" name="pw2" onblur="ttpwd()" placeholder="請確認密碼" required><i class="far fa-eye-slash" onclick="hideShowPsw2()" id="eye2"></i></td>
                <td><div id="nulltpwd"></div></td>
                <script type="text/javascript">
                    var eye2 = document.getElementById("eye2");
                    var pw2 = document.getElementById("pw2");

            function hideShowPsw2(){

                    if (pw2.type == "password") {
                        pw2.type = "text";
                            eye2.className='fa fa-eye'
                    }else {
                        pw2.type = "password";
                        eye2.className='fa fa-eye-slash'
                    }
            }
            </script>
            </tr>
            <!--<tr>
                <td class="topname">手機號碼:</td>
                <td class="phtd"><input class="phone" id="phonenumber" type="tel" name="phonenumber" minlength="10" onblur="ttel()" maxlength="10" placeholder="請輸入電話號碼" required></td>
                <td><div id="nulltel"></div></td>
            </tr>
          -->
            <tr><td class="registertext" colspan="2">*點選「註冊」即表示您同意並接受Miss覓食會員服務條款、隱私權政策</td></tr>
            <tr><td><input id="registerbtn"  class="register" aria-colspan="2" type="button" value="註冊" onclick="reg()"/></td></tr>
        </table>
        </form>
    </div>
    
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>


<script>
    var firebaseConfig = {
    apiKey: "AIzaSyDxT-OAmrrrLwVyqBrUZuVchk5KiINWP5s",
    authDomain: "food-2fcf4.firebaseapp.com",
    databaseURL: "https://food-2fcf4-default-rtdb.firebaseio.com",
    projectId: "food-2fcf4",
    storageBucket: "food-2fcf4.appspot.com",
    messagingSenderId: "801914060441",
    appId: "1:801914060441:web:291d6b957585b577618208"
};
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  var database= firebase.database();
  
  function reg() {
   var email=document.getElementById('email').value;
   var pwd=document.getElementById('pwd').value;
   var pw2=document.getElementById('pw2').value;
   var acc=document.getElementById('acc').value;
   var user =firebase.auth().currentUser;
        registerbtn.addEventListener('click', () => {
        user.sendEmailVerification().then(function(){
          // 驗證信發送完成
          window.alert('驗證信已發送到您的信箱，請查收。')
          
        }).catch(error => {
          // 驗證信發送失敗
          changeErrMessage(error.message);
        });
      });
    
    firebase.auth().createUserWithEmailAndPassword(email,pwd).then(function(){
    alert('請前往信箱驗證!!');
    var id=firebase.auth().currentUser.uid;
    firebase.database().ref('Users/'+id).set({
     acc:acc,
     email:email,
    });
}).catch(function(error){

var errorcode=error.code;
var errormsg=error.message;

});

}


/*const config = {
    apiKey: "AIzaSyBzChAKyehauW4FXCk4DL8jRqtADWquNLA",
    authDomain: "webtest-b833f.firebaseapp.com",
    databaseURL: "https://webtest-b833f-default-rtdb.firebaseio.com",
    projectId: "webtest-b833f",
    storageBucket: "webtest-b833f.appspot.com",
    messagingSenderId: "973102202097",
    appId: "1:973102202097:web:cb78dfd5682687b519fd50"
};
firebase.initializeApp(config);
const database = firebase.database();
registerbtn.addEventListener('click', function(){
  // 點擊註冊按鈕時，紀錄使用者輸入的帳號密碼
  let user = {
    email: email.value,
    pw: pw.value,
    acc:acc.value,
    phonenumber:phonenumber.value
  };

  // 透過 auth().createUserWithEmailAndPassword 建立使用者
  firebase.auth().createUserWithEmailAndPassword(user.email, user.pw)
    .then(u => {
      // 取得註冊當下的時間
      let date = new Date();
      let now = date.getTime();

      // 記錄相關資訊到 firebase realtime database
      database.ref(u.uid).set({
        signup: now,
        email: user.email,
        acc:user.acc,
        phonenumber:user.phonenumber
      }).then(() => {
        // 儲存成功後顯示訊息
        message.innerHTML = 'User created successfully';
      });
    }).catch(err => {
      // 註冊失敗時顯示錯誤訊息
      message.innerHTML = err.message;
    });
});



  /*var auth=firebase.auth();
  function reg_auth(){
    var email = document.getElementById("email").value;
    var pw = document.getElementById("pw").value;
  auth().createUserWithEmailAndPassword(email, pw).then(function(){
    var user =auth.currentUser;
    alert(user.email+"註冊成功");
  }).catch(function(error) {
      alert(error.code);
  })
}    
  /*var database = firebase.database();
  var email = document.getElementById("email");
var pw = document.getElementById("pw");
var regesterbtn = document.getElementById("regesterbtn");
regesterbtn.addEventListener("click", function reg(e){
    e.preventDefault();
    firebase.auth().createUserWithEmailAndPassword(email.value, pw.value).then(()=>{
console.log("註冊成功");
    })
});
//Email/Pwd註冊
//var loginUser;
/*var acc = document.getElementById("acc");
var email = document.getElementById("email");
var pw = document.getElementById("pw");
var pw2 = document.getElementById("pw2");
var phonenumber = document.getElementById("phonenumber");
var regesterbtn = document.getElementById("regesterbtn");
regesterbtn.addEventListener("click", function (){
		console.log(acc.value);
    firebase.auth().createUserWithEmailAndPassword(email.value, pw.value).then(function(){
    	//登入成功後，取得登入使用者資訊
    	loginUser = firebase.auth().currentUser;
      console.log("登入使用者為",loginUser);
      firebase.database().ref('users/' + loginUser.uid).set({
        acc: loginUser.acc,
        phonenumber: phonenumber.value,
        email : email.value
      }).catch(function(error){
      	console.error("寫入使用者資訊錯誤",error);
      });
    }).catch(function(error) {
    // Handle Errors here.
    var errorCode = error.code;
    var errorMsg = error.message;
    console.log(errorMsg);
  });
},false);*/
</script>
</body>
</html>
